<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Formulario</title>
  <style>
    .recaptcha-widget {
      display: inline-flex;
      align-items: center;
      gap: 14px;
      padding: 12px 16px;
      width: 100%;
      max-width: 320px;
      height: 74px;
      box-sizing: border-box;
      background: #f9f9f9;
      border: 1px solid #d3d3d3;
      border-radius: 4px;
      box-shadow: 0 1px 1px rgba(0,0,0,0.1);
      cursor: pointer;
    }
    .recaptcha-widget:hover {
      border-color: #b0b0b0;
    }
    .recaptcha-checkbox-wrap {
      position: relative;
      width: 24px;
      height: 24px;
      flex-shrink: 0;
    }
    .recaptcha-checkbox {
      width: 24px;
      height: 24px;
      margin: 0;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 2px;
      cursor: pointer;
      accent-color: #1a73e8;
      position: relative;
      z-index: 1;
    }
    .recaptcha-loading {
      position: absolute;
      left: 0;
      top: 0;
      width: 24px;
      height: 24px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.15s;
    }
    .recaptcha-loading.activo {
      opacity: 1;
    }
    .recaptcha-loading circle {
      fill: none;
      stroke: #0f9d58;
      stroke-width: 2.5;
      stroke-linecap: round;
      stroke-dasharray: 54;
      stroke-dashoffset: 54;
      transform: rotate(-90deg);
      transform-origin: 12px 12px;
    }
    .recaptcha-loading.activo circle {
      animation: cargar-circulo 0.6s ease-out forwards;
    }
    @keyframes cargar-circulo {
      to {
        stroke-dashoffset: 0;
      }
    }
    .recaptcha-text {
      flex: 1;
      font-family: Arial, Helvetica, sans-serif;
      font-size: 17px;
      color: #444;
      cursor: pointer;
      user-select: none;
    }
    .recaptcha-brand {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 2px;
    }
    .recaptcha-logo {
      width: 32px;
      height: 32px;
    }
    .recaptcha-brand-text {
      font-family: Arial, Helvetica, sans-serif;
      font-size: 12px;
      color: #7f7f7f;
    }
    .recaptcha-links {
      font-family: Arial, Helvetica, sans-serif;
      font-size: 10px;
      color: #999;
    }
    .recaptcha-links a {
      color: #999;
      text-decoration: none;
    }
    .cuadricula-panel {
      display: none;
      margin-top: 12px;
      max-width: 400px;
      border: 1px solid #d3d3d3;
      border-radius: 4px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .cuadricula-panel.activo {
      display: block;
    }
    .cuadricula-aviso {
      background: #1a73e8;
      color: #fff;
      padding: 12px 16px;
      font-family: Arial, Helvetica, sans-serif;
      font-size: 15px;
      transition: background 0.2s;
    }
    .cuadricula-panel.error .cuadricula-aviso {
      background: #c5221f;
    }
    .cuadricula-imagen {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: repeat(4, 1fr);
      width: 400px;
      height: 400px;
      background: #f0f0f0;
    }
    .cuadricula-imagen.temblar {
      animation: temblar 0.5s ease-in-out;
    }
    @keyframes temblar {
      0%, 100% { transform: translateX(0); }
      15% { transform: translateX(-4px) translateY(-2px); }
      30% { transform: translateX(4px) translateY(2px); }
      45% { transform: translateX(-4px) translateY(2px); }
      60% { transform: translateX(4px) translateY(-2px); }
      75% { transform: translateX(-2px) translateY(0); }
    }
    .cuadricula-celda {
      border: 1px solid #ccc;
      cursor: pointer;
      background-size: 400% 400%;
      box-sizing: border-box;
    }
    .cuadricula-celda:hover {
      outline: 2px solid #1a73e8;
      outline-offset: -2px;
    }
    .cuadricula-celda.seleccionado {
      outline: 3px solid #1a73e8;
      outline-offset: -3px;
      background-color: rgba(26, 115, 232, 0.2);
    }
    .cuadricula-confirmar {
      padding: 10px 16px;
      background: #f9f9f9;
      border-top: 1px solid #d3d3d3;
    }
    .cuadricula-confirmar button {
      padding: 8px 20px;
      background: #1a73e8;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    .cuadricula-confirmar button:hover {
      background: #1557b0;
    }
  </style>
</head>
<body>
  <h1>Formulario</h1>
  <form id="formulario">
    <p>
      <label for="correo">Correo:</label><br>
      <input type="email" id="correo" name="correo" required>
    </p>
    <p>
      <label for="cedula">Cédula:</label><br>
      <input type="text" id="cedula" name="cedula" required>
    </p>
    <p>
      <label class="recaptcha-widget" for="verificacion">
        <span class="recaptcha-checkbox-wrap">
          <input type="checkbox" id="verificacion" name="verificacion" class="recaptcha-checkbox" required>
          <span class="recaptcha-loading" id="recaptcha-loading" aria-hidden="true">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <circle cx="12" cy="12" r="8.6"/>
            </svg>
          </span>
        </span>
        <span class="recaptcha-text">I'm not a robot</span>
        <span class="recaptcha-brand">
          <svg class="recaptcha-logo" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
            <!-- Flecha azul (sentido horario, arriba-derecha) -->
            <path fill="none" stroke="#1a73e8" stroke-width="2.5" stroke-linecap="round" d="M22 10 A10 10 0 0 1 22 22 L18 18" />
            <!-- Flecha gris (sentido antihorario, abajo-izquierda) -->
            <path fill="none" stroke="#9e9e9e" stroke-width="2.5" stroke-linecap="round" d="M10 22 A10 10 0 0 1 10 10 L14 14" />
          </svg>
          <span class="recaptcha-brand-text">reCAPTCHA</span>
          <span class="recaptcha-links"><a href="#">Privacy</a> - <a href="#">Terms</a></span>
        </span>
      </label>
    </p>
    <p>
      <button type="submit">Enviar</button>
    </p>
    <div class="cuadricula-panel" id="cuadricula-panel">
      <div class="cuadricula-aviso">Seleccione las partes donde esta el automovil</div>
      <div class="cuadricula-imagen" id="cuadricula-imagen"></div>
      <div class="cuadricula-confirmar">
        <button type="button" id="cuadricula-confirmar">Verificar</button>
      </div>
    </div>
  </form>
  <p id="mensaje"></p>

  <script>
    (function() {
      var checkbox = document.getElementById('verificacion');
      var loading = document.getElementById('recaptcha-loading');
      var panel = document.getElementById('cuadricula-panel');
      var grid = document.getElementById('cuadricula-imagen');
      var btnConfirmar = document.getElementById('cuadricula-confirmar');
      var animando = false;
      var imagenUrl = 'automovil.png';
      // Celdas correctas: fila 2 cols 2,3,4; fila 3 cols 2,3,4; fila 4 cols 2,3,4 (filas/cols en 1-based; en 0-based: filas 1,2,3 y cols 1,2,3)
      var correctos = [5, 6, 7, 9, 10, 11, 13, 14, 15];

      function crearCuadricula() {
        grid.innerHTML = '';
        grid.classList.remove('temblar');
        panel.classList.remove('error');
        for (var fila = 0; fila < 4; fila++) {
          for (var col = 0; col < 4; col++) {
            var idx = fila * 4 + col;
            var celda = document.createElement('div');
            celda.className = 'cuadricula-celda';
            celda.setAttribute('data-idx', idx);
            celda.style.backgroundImage = 'url(' + imagenUrl + ')';
            celda.style.backgroundSize = '400% 400%';
            celda.style.backgroundPosition = (col * -100) + '% ' + (fila * -100) + '%';
            celda.addEventListener('click', function() {
              this.classList.toggle('seleccionado');
            });
            grid.appendChild(celda);
          }
        }
      }

      function obtenerSeleccion() {
        var celdas = grid.querySelectorAll('.cuadricula-celda.seleccionado');
        var idx = [];
        for (var i = 0; i < celdas.length; i++) idx.push(parseInt(celdas[i].getAttribute('data-idx'), 10));
        idx.sort(function(a, b) { return a - b; });
        return idx;
      }

      function sonIguales(a, b) {
        if (a.length !== b.length) return false;
        for (var i = 0; i < a.length; i++) if (a[i] !== b[i]) return false;
        return true;
      }

      checkbox.addEventListener('change', function() {
        if (!checkbox.checked) return;
        if (animando) {
          animando = false;
          return;
        }
        animando = true;
        checkbox.checked = false;
        loading.classList.add('activo');
        setTimeout(function() {
          loading.classList.remove('activo');
          animando = false;
          crearCuadricula();
          panel.classList.add('activo');
        }, 600);
      });

      btnConfirmar.addEventListener('click', function() {
        var seleccion = obtenerSeleccion();
        if (!sonIguales(seleccion, correctos)) {
          var celdas = grid.querySelectorAll('.cuadricula-celda.seleccionado');
          for (var i = 0; i < celdas.length; i++) celdas[i].classList.remove('seleccionado');
          panel.classList.add('error');
          grid.classList.add('temblar');
          setTimeout(function() {
            grid.classList.remove('temblar');
            panel.classList.remove('error');
          }, 500);
          return;
        }
        panel.classList.remove('activo');
        panel.classList.remove('error');
        loading.classList.add('activo');
        setTimeout(function() {
          loading.classList.remove('activo');
          checkbox.checked = true;
        }, 600);
      });

      document.getElementById('formulario').addEventListener('submit', function(e) {
        e.preventDefault();
        var correo = document.getElementById('correo').value.trim();
        var cedula = document.getElementById('cedula').value.trim();
        var verificacion = document.getElementById('verificacion').checked;
        var msg = document.getElementById('mensaje');

        if (!correo || !cedula) {
          msg.textContent = 'Complete correo y cédula.';
          return;
        }
        if (!verificacion) {
          msg.textContent = 'Marque la casilla para continuar.';
          return;
        }
        msg.textContent = 'Enviado correctamente.';
      });
    })();
  </script>
</body>
</html>
